<html><head><title>AudioMulchClock</title>
<link rel='stylesheet' href='./../scdoc.css' type='text/css' />
<link rel='stylesheet' href='./../frontend.css' type='text/css' />
<link rel='stylesheet' href='./../custom.css' type='text/css' />
<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
<script src='./../scdoc.js' type='text/javascript'></script>
<script src='./../docmap.js' type='text/javascript'></script>
<script src='./../prettify.js' type='text/javascript'></script>
<script src='./../lang-sc.js' type='text/javascript'></script>
<script src='./../MathJax/MathJax.js?config=TeX-AMS_HTML,scmathjax' type='text/javascript'></script>
<script type='text/javascript'>var helpRoot='./..';</script>
</head>
<ul id='menubar'></ul>
<body onload='fixTOC();prettyPrint()'>
<div class='contents'>
<div class='header'>
<div id='label'>SuperCollider CLASSES (extension)</div>
<div id='categories'><a href='./../Browse.html#Scheduling>Clocks'>Scheduling>Clocks</a>, <a href='./../Browse.html#Quarks>AudioMulchClock'>Quarks>AudioMulchClock</a></div>
<h1>AudioMulchClock</h1>
<div id='summary'>clock that slaves to AudioMulch over network</div>
</div>
<div class='subheader'>
<div id='filename'>Source: /Users/vagelis/Library/Application Support/SuperCollider/Extensions/quarks/AudioMulchClock/<a href='file:///Users/vagelis/Library/Application Support/SuperCollider/Extensions/quarks/AudioMulchClock/AudioMulchClock.sc'>AudioMulchClock.sc</a></div><div id='superclasses'>Inherits from: <a href="../Classes/Object.html">Object</a></div>
<div id='related'>See also: <a href="./../Classes/ClockAudioMulch.html">ClockAudioMulch</a></div>
</div>
<div id='toc'>
<ul class='toc'><li class='toc1'><a href='#description'>Description</a></li>
<ul class='toc'><li class='toc2'><a href='#Network setup'>Network setup</a></li>
<ul class='toc'></ul><li class='toc2'><a href='#Known issues'>Known issues</a></li>
<ul class='toc'></ul></ul><li class='toc1'><a href='#classmethods'>Class methods</a></li>
<ul class='toc'><li class='toc3'><a href='#*new'>new</a> </li>
<li class='toc3'><a href='#*default'>default</a> </li>
<li class='toc2'><a href='#Inherited class methods'>Inherited class methods</a></li>
</ul><li class='toc1'><a href='#instancemethods'>Instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-play'>play</a> </li>
<li class='toc3'><a href='#-schedAbs'>schedAbs</a> </li>
<li class='toc3'><a href='#-sched'>sched</a> </li>
<li class='toc3'><a href='#-nextTimeOnGrid'>nextTimeOnGrid</a> </li>
<li class='toc3'><a href='#-clear'>clear</a> </li>
<li class='toc3'><a href='#-beatDur'>beatDur</a> </li>
<li class='toc3'><a href='#-beats'>beats</a> </li>
<li class='toc3'><a href='#-running'>running</a> </li>
<li class='toc3'><a href='#-tick'>tick</a> </li>
<li class='toc3'><a href='#-shift'>shift</a> </li>
<li class='toc3'><a href='#-beatsPerBar'>beatsPerBar</a> </li>
<li class='toc3'><a href='#-permanent'>permanent</a> </li>
<li class='toc3'><a href='#-tempo'>tempo</a> </li>
<li class='toc3'><a href='#-startAction'>startAction</a> </li>
<li class='toc3'><a href='#-stopAction'>stopAction</a> </li>
<li class='toc2'><a href='#Inherited instance methods'>Inherited instance methods</a></li>
<li class='toc2'><a href='#Undocumented instance methods'>Undocumented instance methods</a></li>
<ul class='toc'><li class='toc3'><a href='#-doPulse'>doPulse</a> </li>
<li class='toc3'><a href='#-doSched'>doSched</a> </li>
</ul></ul><li class='toc1'><a href='#examples'>Examples</a></li>
<ul class='toc'></ul></ul></div><h2><a class='anchor' name='description'>Description</a></h2>

<p>Use this class to <strong>receive</strong> sync and have SuperCollider act as a <strong>slave</strong>.
<p>AudioMulch is a program written by Ross Bencina. <a href="http://www.audiomulch.com/">http://www.audiomulch.com/</a>
<p>AudioMulchClock is a SuperCollider class for synchronising playback with this program via network sync.
<p>This clock has no notion of time in seconds. Rather time advances in ticks and each incoming network sync message includes a tick counter. There are 24 ticks per beat and 96 per bar (assuming 4/4 - change beatsPerBar to use something different).
<p>A tick is roughly 1/24 seconds long at tempo 60bpm. Though network jitter will add and subtract to this value.
<p>Sub tick accurate scheduling (precision lower than 1/24th of a beat) is also possible.<h3><a class='anchor' name='Network setup'>Network setup</a></h3>

<p>In AudioMulch's preference panel under the <em>Network Sync</em> tab, set the <em>Send to address</em> to 127.0.0.1 and the corresponding UDP Port to 57120. Activate <em>Generate Network Sync</em> under the Control meny.<h3><a class='anchor' name='Known issues'>Known issues</a></h3>

<p>Pbind legato does not behave correctly - scale it with beat duration.<h2><a class='anchor' name='classmethods'>Class Methods</a></h2>
<h3 class='cmethodname'><span class='methprefix'>*</span><a name='*new' href='./../Overviews/Methods.html#new'>new</a> </h3>
<div class='method'>
<p>Creates a new clock.</div><h3 class='cmethodname'><span class='methprefix'>*</span><a name='*default' href='./../Overviews/Methods.html#default'>default</a> </h3>
<div class='method'>
<p>Returns the default clock. It is created the first time you try to access it and is permanent.</div><h3><a class='anchor' name='Inherited class methods'>Inherited class methods</a></h3>
<div id='inheritedclassmets'></div><h2><a class='anchor' name='instancemethods'>Instance Methods</a></h2>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-play' href='./../Overviews/Methods.html#play'>play</a> (<span class='argstr'>task</span>, <span class='argstr'>quant: 1</span>)</h3>
<div class='method'>
<p>Schedules a function to be evaluated at some future beat - usually the next beat or next 4 beats (bar).<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>task<td class='argumentdesc'>
<p>A <a href="./../Classes/Function.html">Function</a>. The function is passed tick, time and clock as first three arguments.<tr><td class='argumentname'>quant<td class='argumentdesc'>
<p>1 plays on the next beat, 4 on the next bar etc. Also fractions of beats are possible.</table></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-schedAbs' href='./../Overviews/Methods.html#schedAbs'>schedAbs</a> (<span class='argstr'>tick</span>, <span class='argstr'>item</span>)</h3>
<div class='method'>
<p>Schedules a function to be evaluated at a certain <em>tick</em>.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>tick<td class='argumentdesc'>
<p>Use <code class='code prettyprint lang-sc'>.tick</code> to find the current tick and then add an offset in ticks to that. Also fractions of ticks are possible for sub tick accuracy.<tr><td class='argumentname'>item<td class='argumentdesc'>
<p>A <a href="./../Classes/Function.html">Function</a>. The function is passed tick, time and clock as first three arguments. If the function returns a number, it will be rescheduled in that amount of beats (yes, not ticks).</table></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-sched' href='./../Overviews/Methods.html#sched'>sched</a> (<span class='argstr'>delta</span>, <span class='argstr'>item</span>)</h3>
<div class='method'>
<p>Schedules a function to be evaluated at some future beat.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>delta<td class='argumentdesc'>
<p>1 here means the next upcoming beat. Also fractions of beats are possible as well as sub tick accuracy (1&lt;24th of a beat).<tr><td class='argumentname'>item<td class='argumentdesc'>
<p>A <a href="./../Classes/Function.html">Function</a>. The function is passed tick, time and clock as first three arguments. If the function returns a number, it will be rescheduled in that amount of beats.</table></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-nextTimeOnGrid' href='./../Overviews/Methods.html#nextTimeOnGrid'>nextTimeOnGrid</a> (<span class='argstr'>quant: 1</span>, <span class='argstr'>phase: 0</span>)</h3>
<div class='method'>
<p>Used for finding out at which tick in the future the next beat or bar will occur.<h4>Arguments:</h4>
<table class='arguments'>
<tr><td class='argumentname'>quant<td class='argumentdesc'>
<p>If 1 then return the tick for the next tick%24==0. If 4 then the tick for the next tick%96==0 etc.<tr><td class='argumentname'>phase<td class='argumentdesc'>
<p>Adds to the quant. e.g. quant 4 and phase 2 will return the tick at the next bar + two beats.</table></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-clear' href='./../Overviews/Methods.html#clear'>clear</a> </h3>
<div class='method'>
<p>Stops the clock and removes all tasks from the scheduling queue.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-beatDur' href='./../Overviews/Methods.html#beatDur'>beatDur</a> </h3>
<div class='method'>
<p>Return the average beat duration in seconds.<div class='note'><span class='notelabel'>NOTE:</span> This value will fluctuate because of network jitter.</div></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-beats' href='./../Overviews/Methods.html#beats'>beats</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-beats' href='./../Overviews/Methods.html#beats'>beats</a> = </h3>
<div class='method'>
<p>Return the current beat.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-running' href='./../Overviews/Methods.html#running'>running</a> </h3>
<div class='method'>
<p>A <a href="./../Classes/Boolean.html">Boolean</a> that is set when either a <code class='code prettyprint lang-sc'>\t_start</code> or a <code class='code prettyprint lang-sc'>\t_pulse</code> message is received. It is cleard when a <code class='code prettyprint lang-sc'>\t_stop</code> message is received or the clock is cleared.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-tick' href='./../Overviews/Methods.html#tick'>tick</a> </h3>
<div class='method'>
<p>An <a href="./../Classes/Integer.html">Integer</a> that counts up indefinitely.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-shift' href='./../Overviews/Methods.html#shift'>shift</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-shift' href='./../Overviews/Methods.html#shift'>shift</a> = value</h3>
<div class='method'>
<p>An <a href="./../Classes/Integer.html">Integer</a> specifying latency compensation in ticks. If negative items will be scheduled slightly early.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-beatsPerBar' href='./../Overviews/Methods.html#beatsPerBar'>beatsPerBar</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-beatsPerBar' href='./../Overviews/Methods.html#beatsPerBar'>beatsPerBar</a> = value</h3>
<div class='method'>
<p>An <a href="./../Classes/Integer.html">Integer</a> that should match the number of beats in a bar. Used when restarting after a <code class='code prettyprint lang-sc'>\t_stop</code>.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-permanent' href='./../Overviews/Methods.html#permanent'>permanent</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-permanent' href='./../Overviews/Methods.html#permanent'>permanent</a> = value</h3>
<div class='method'>
<p>A <a href="./../Classes/Boolean.html">Boolean</a>. If true then the clock will continue to run after a <a href="./../Classes/CmdPeriod.html">CmdPeriod</a>. The user is responsible for clearing permanent clocks with the <a href="#-clear">-clear</a> method.</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-tempo' href='./../Overviews/Methods.html#tempo'>tempo</a> </h3>
<div class='method'>
<p>A <a href="./../Classes/Float.html">Float</a> that represents the average tempo in beats per minutes.<div class='note'><span class='notelabel'>NOTE:</span> This value will fluctuate because of network jitter.</div></div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-startAction' href='./../Overviews/Methods.html#startAction'>startAction</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-startAction' href='./../Overviews/Methods.html#startAction'>startAction</a> = value</h3>
<div class='method'>
<p>A <a href="./../Classes/Function.html">Function</a> that is evaluated when the external clock is started (a <code class='code prettyprint lang-sc'>\t_start</code> is received).</div><h3 class='imethodname'><span class='methprefix'>-</span><a name='-stopAction' href='./../Overviews/Methods.html#stopAction'>stopAction</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-stopAction' href='./../Overviews/Methods.html#stopAction'>stopAction</a> = value</h3>
<div class='method'>
<p>A <a href="./../Classes/Function.html">Function</a> that is evaluated when the external clock is stopped (a <code class='code prettyprint lang-sc'>\t_stop</code> is received).</div><h3><a class='anchor' name='Inherited instance methods'>Inherited instance methods</a></h3>
<div id='inheritedinstmets'></div><h3><a class='anchor' name='Undocumented instance methods'>Undocumented instance methods</a></h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-doPulse' href='./../Overviews/Methods.html#doPulse'>doPulse</a> (<span class='argstr'>t</span>, <span class='argstr'>r</span>, <span class='argstr'>m</span>)</h3>
<h3 class='imethodname'><span class='methprefix'>-</span><a name='-doSched' href='./../Overviews/Methods.html#doSched'>doSched</a> (<span class='argstr'>ofs</span>, <span class='argstr'>item</span>, <span class='argstr'>tickdur</span>)</h3>
<h2><a class='anchor' name='examples'>Examples</a></h2>
<pre class='code prettyprint lang-sc'>s.latency= 0.05;
s.boot;

a= AudioMulchClock.new;
//now press play in AudioMulch - make sure 'Generate Network Sync' is set under the control menu.
a.beatDur    //will fluctuate because of network jitter
a.beats
a.tempo        //will fluctuate because of network jitter
a.tick



//--patterns - note that legato needs to be scaled down - still not working properly
b= Pbind(\degree, Pseq([0, 5, 2, 1, 0, 5, 2, 1, 0, -1], inf), \dur, Pseq([1, 1, 1, 1, 0.25, 0.25, 0.5, 1, 1, 1], inf), \legato, Pfunc({a.beatDur})).play(a, quant:4)
a.shift= -3;    //latency compenstation.  3 ticks early
//now try changing tempo in AudioMulch
b.stop
a.clear



//--show manual scheduling in beats
a= AudioMulchClock.new;
(
a.sched(3.5, {|tick, time, clock|
    ("3.5 beats later - relative to now"+tick+time+clock).postln;
    nil;
})
)

(
//note: schedAbs works in ticks so you need to scale with ticks per beat (24)
a.schedAbs(a.tick+(2*24), {|tick, time, clock|
    ("2 beats later (48 ticks) - absolute time"+tick+time+clock).postln;
    nil;
})
)

(
//schedules a synth at half a beat after the beginning of the next bar
a.schedAbs(a.nextTimeOnGrid(4, 0.5), {|tick, time, clock|
    var syn= Synth(\default);
    a.sched(1, {
        syn.release;
        nil;
    });
    4;    //reschedule every 4 beat
})
)
a.clear



//--two pbinds on the same clock
(
SynthDef(\audiomulchclock, {|out= 0, atk= 0.01, rel= 0.2, gate= 1, freq= 400, pan= 0, amp= 1|
    var env= EnvGen.kr(Env.asr(atk, amp, rel), gate, doneAction:2);
    var src= MoogFF.ar(
        Pulse.ar(freq-(amp-env*50), env*0.25+0.5, env),
        env.lag(2).exprange(freq*0.5, freq*2),
        3
    );
    Out.ar(out, Pan2.ar(src, pan));
}).add;
)
a= AudioMulchClock.new;
a.shift= -4;
b= Pbind(\instrument, \audiomulchclock, \degree, Pseq([0, 5, 2, 1, 0, 5, 2, 1], inf)*[1, 0.5], \strum, 0.2, \dur, 0.5, \pan, [0.5, -0.5], \amp, cos(Ptime()*0.3), \legato, Pfunc({a.beatDur})).play(a, quant:4);
c= Pbind(\instrument, \audiomulchclock, \degree, Pn(Pshuf([0, 5, 2, 1, 0, 5, 2, 1], 4), inf)*[1, 0.5], \strum, 0.1, \dur, 0.5, \pan, [-0.5, 0.5], \amp, cos(Ptime()*0.2), \legato, Pfunc({a.beatDur}), \octave, 7).play(a, quant:4);
c.stop
b.stop
a.clear</pre>

<p><div class='doclink'>source: <a href='file:///Users/vagelis/Library/Application Support/SuperCollider/Extensions/quarks/AudioMulchClock/HelpSource/Classes/AudioMulchClock.schelp'>/Users/vagelis/Library/Application Support/SuperCollider/Extensions/quarks/AudioMulchClock/HelpSource/Classes/AudioMulchClock.schelp</a><br>link::Classes/AudioMulchClock::<br>sc version: 3.5.3</div></div></body></html>